name: Sync to Gitea

on:
  push:
    branches:
      - main  # 根据需要修改为你想要监控的分支

jobs:
  sync:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout the repository
        uses: actions/checkout@v2
        with:
          fetch-depth: 0  # 完整克隆整个历史记录

      - name: Set Git Identity
        run: |
          git config --global user.name "KolinLoa"
          git config --global user.email "liukang861@yahoo.com"

      - name: Configure Git for Gitea
        env:
          GITEA_URL: gitea.com
          GITEA_USERNAME: KolinLoa
          GITEA_TOKEN: ${{ secrets.GITEA_TOKEN }}
        run: |
          git remote add gitea https://${{ env.GITEA_USERNAME }}:${{ env.GITEA_TOKEN }}@${{ env.GITEA_URL }}/KolinLoa/jx3-DrytronII.git
          git fetch gitea main  # 拉取 Gitea 仓库的历史记录
          git merge gitea/main --allow-unrelated-histories  # 合并历史记录，如果 Gitea 和 GitHub 的历史不同

      - name: Push to Gitea
        run: git push gitea main  # 推送到 Gitea
